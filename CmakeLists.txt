cmake_minimum_required(VERSION 3.18)
project(opengl_engine LANGUAGES CXX)

# CMAKE Standards
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_BUILD_TYPE Debug)

# Locate needed libraries
find_package(OpenGL REQUIRED)
find_package(glfw3 REQUIRED)
find_package(GLEW REQUIRED)

# Define imported DLL
add_library(libassimp SHARED IMPORTED)

# Specify location of DLL, import library and headers
set_target_properties(libassimp PROPERTIES
    IMPORTED_LOCATION "${CMAKE_CURRENT_SOURCE_DIR}/lib/libassimp-6.dll"
    IMPORTED_IMPLIB "${CMAKE_CURRENT_SOURCE_DIR}/lib/libassimp-6.dll"
    INTERFACE_INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/include"
)

add_library(studioFMOD SHARED IMPORTED)

set_target_properties(studioFMOD PROPERTIES
    IMPORTED_LOCATION "${CMAKE_CURRENT_SOURCE_DIR}/lib/fmodstudio.dll"
    IMPORTED_IMPLIB "${CMAKE_CURRENT_SOURCE_DIR}/lib/fmodstudio.dll"
    INTERFACE_INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/FMOD/api/studio/inc"
)

add_library(coreFMOD SHARED IMPORTED)

set_target_properties(coreFMOD PROPERTIES
    IMPORTED_LOCATION "${CMAKE_CURRENT_SOURCE_DIR}/lib/fmod.dll"
    IMPORTED_IMPLIB "${CMAKE_CURRENT_SOURCE_DIR}/lib/fmod.dll"
    INTERFACE_INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/FMOD/api/core/inc" 
)

add_executable(${CMAKE_PROJECT_NAME} 
    src/main.cpp 
    src/engine/engine.cpp 
    src/shader/shader.cpp 
    src/timer/timer.cpp 
    src/image_loader/image_loader.cpp 
    src/camera/camera.cpp
    src/mesh/mesh.cpp
    src/model/model.cpp
    src/audio/audio_engine.cpp

    imgui/imgui.cpp
    imgui/imgui_demo.cpp
    imgui/imgui_draw.cpp
    imgui/imgui_tables.cpp
    imgui/imgui_widgets.cpp
    imgui/backends/imgui_impl_glfw.cpp
    imgui/backends/imgui_impl_opengl3.cpp
)

if(${CMAKE_BUILD_TYPE} STREQUAL Debug)
    target_compile_definitions(${CMAKE_PROJECT_NAME} PUBLIC RESOURCES="${CMAKE_CURRENT_SOURCE_DIR}/resources")
else()
    target_compile_definitions(${CMAKE_PROJECT_NAME} PUBLIC RESOURCES="./resources")
endif()

target_include_directories(${CMAKE_PROJECT_NAME} PRIVATE
    "${CMAKE_CURRENT_SOURCE_DIR}/include/assimp"
    "${CMAKE_CURRENT_SOURCE_DIR}/FMOD/api/studio/inc"
    "${CMAKE_CURRENT_SOURCE_DIR}/FMOD/api/core/inc"
)

# Linking all required libraries
target_link_libraries(${CMAKE_PROJECT_NAME} PRIVATE 
    OpenGL::GL 
    GLEW::GLEW 
    glfw 
    libassimp
    studioFMOD
    coreFMOD
)

# Include libgcc and libstdc++ for retrieving dll libraries
if(${CMAKE_BUILD_TYPE} STREQUAL Release)
    target_link_options(${CMAKE_PROJECT_NAME} PRIVATE -static-libgcc -static-libstdc++)
endif()